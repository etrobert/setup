#!/bin/bash
# Generate waybar config by merging shared + specific config
# Usage: generate-waybar-configs.sh <name>
# Example: generate-waybar-configs.sh top

if [ -z "$1" ]; then
  echo "Usage: $0 <name>"
  echo "Example: $0 top"
  exit 1
fi

CONFIG_DIR="$HOME/.config/waybar"
SOURCE_DIR="$CONFIG_DIR/source"

if [ ! -f "$SOURCE_DIR/$1.jsonc" ]; then
  echo "Error: $SOURCE_DIR/$1.jsonc not found"
  exit 1
fi

{
  echo "// AUTO-GENERATED - DO NOT EDIT"
  echo "// Generated from: source/shared.jsonc + source/$1.jsonc"
  echo ""
  jq --slurp '.[0] * .[1]' \
    <(strip-json-comments "$SOURCE_DIR/shared.jsonc") \
    <(strip-json-comments "$SOURCE_DIR/$1.jsonc")
} >"$CONFIG_DIR/config.jsonc"

echo "done"
