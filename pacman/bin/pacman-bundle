#!/bin/sh

set -e

dump_packages() {
  echo "Dumping packages to pkglist.txt..."
  pacman -Qqen >pkglist.txt
  echo "âœ… Dumped $(wc -l <pkglist.txt) packages to pkglist.txt"
}

install_packages() {
  # Check if pkglist.txt exists
  if [ ! -f "pkglist.txt" ]; then
    echo "Error: pkglist.txt not found"
    exit 1
  fi

  # File can be read by user
  # shellcheck disable=SC2024
  sudo pacman -S --needed - <pkglist.txt
}

# Require a command
case "$1" in
dump)
  dump_packages
  ;;
install)
  install_packages
  ;;
*)
  echo "Usage: pacman-bundle {dump|install}"
  echo "  dump     - Export current packages to pkglist.txt"
  echo "  install  - Install packages from pkglist.txt"
  exit 1
  ;;
esac
