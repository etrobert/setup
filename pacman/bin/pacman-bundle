#!/bin/sh

set -e

dump_packages() {
  echo "Dumping official packages to pkglist.txt..."
  pacman -Qqen >pkglist.txt
  echo "✅ Dumped $(wc -l <pkglist.txt) official packages to pkglist.txt"

  echo "Dumping AUR packages to foreignpkglist.txt..."
  pacman -Qqem >foreignpkglist.txt
  echo "✅ Dumped $(wc -l <foreignpkglist.txt) AUR packages to foreignpkglist.txt"
}

install_packages() {
  # Install official packages
  if [ -f "pkglist.txt" ]; then
    echo "Installing official packages..."
    # shellcheck disable=SC2024
    sudo pacman -S --needed - <pkglist.txt
  else
    echo "pkglist.txt not found, skipping official packages"
  fi

  # Install AUR packages
  if [ -f "foreignpkglist.txt" ]; then
    echo "Installing AUR packages..."
    yay -S --needed - <foreignpkglist.txt
  else
    echo "foreignpkglist.txt not found, skipping AUR packages"
  fi
}

# Require a command
case "$1" in
dump)
  dump_packages
  ;;
install)
  install_packages
  ;;
*)
  echo "Usage: pacman-bundle {dump|install}"
  echo "  dump     - Export current packages to pkglist.txt"
  echo "  install  - Install packages from pkglist.txt"
  exit 1
  ;;
esac
