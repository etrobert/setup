#!/bin/sh

set -e

REPO_NAME=$(basename "$(git remote get-url origin)" .git)

BRANCH="$1"

if [ -z "$BRANCH" ]; then
  echo "Usage: $0 <worktree-name>"
  exit 1
fi

NAME="$REPO_NAME-$BRANCH"

WORKTREE_PATH="$HOME/work/$NAME"

# TODO: make it work for new branches and existing branches
# git worktree add "$WORKTREE_PATH" -b "$BRANCH"
git worktree add "$WORKTREE_PATH" "$BRANCH"

# TODO: Use correct path
# TODO .claude/settings.local.json
for file in .env .tmux.conf; do
  if [ -f "$file" ]; then
    cp "$file" "$WORKTREE_PATH"
  fi
done

tmux-sessionizer "$NAME"
