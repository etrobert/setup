#!/bin/sh

# Inspired by https://github.com/ThePrimeagen/.dotfiles/blob/master/bin/.local/scripts/tmux-sessionizer

if [ $# -eq 1 ]; then
  project=$(echo "$1" | sed 's/\/$//')
else
  project=$({
    find "$HOME/work" -mindepth 1 -maxdepth 1 -type d -exec basename {} \;
    echo "setup"
  } | fzf)
fi

if [ -z "$project" ]; then
  exit 0
fi

if [ "$project" = "setup" ]; then
  project_path=$HOME/setup
else
  project_path=$HOME/work/$project
fi

project=$(echo "$project" | sed 's/\./_/g')

if ! tmux has-session -t="$project" 2>/dev/null; then
  tmux new-session -d -s "$project" -c "$project_path"
fi

if [ -z "$TMUX" ]; then
  tmux attach-session -t "$project"
else
  tmux switch-client -t "$project"
fi
